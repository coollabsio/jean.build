---
import Layout from "../layouts/Layout.astro";
---

<Layout>
  <!-- Hero Section -->
  <section class="pt-12 md:pt-24 pb-10 text-center px-4">
    <h1 class="text-3xl md:text-6xl font-bold tracking-tight">
      Your AI dev team, parallelized<span class="text-[#FCD34D]">.</span>
    </h1>
    <p
      class="mt-6 text-neutral-400 max-w-4xl mx-auto text-base md:text-lg leading-relaxed"
    >
      Run AI agents in parallel, in isolated workspaces. Automated worktree
      management, context loading from GitHub, magic git commands, and more.
      Open source and free forever.
    </p>

    <!-- Download Badge -->
    <div
      class="mt-6 inline-flex items-center gap-2 bg-coolgray-300/60 text-sm px-4 py-2 rounded"
    >
      <svg
        class="w-4 h-4 text-[#FCD34D]"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="1.5"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M9 17.25v1.007a3 3 0 01-.879 2.122L7.5 21h9l-.621-.621A3 3 0 0115 18.257V17.25m6-12V15a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 15V5.25A2.25 2.25 0 015.25 3h13.5A2.25 2.25 0 0121 5.25z"
        ></path>
      </svg>
      <span class="text-neutral-400">Tested on macOS — Windows &amp; Linux <a href="https://github.com/coollabsio/jean" target="_blank" class="text-[#FCD34D] underline">testers needed</a></span>
    </div>

    <!-- Download -->
    <div class="mt-8 max-w-xl mx-auto relative">
      <div class="flex">
        <a
          id="download-btn"
          href="https://github.com/coollabsio/jean/releases/latest"
          class="font-mono bg-coolgray-300 px-4 py-3 rounded-l text-xs md:text-sm text-left flex items-center justify-between hover:bg-coolgray-400 transition-colors cursor-pointer flex-1"
        >
          <div class="flex items-center gap-2">
            <svg
              class="w-5 h-5 text-[#FCD34D]"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3"
              ></path>
            </svg>
            <span id="download-label">Download for your platform</span>
          </div>
          <span id="download-version" class="text-neutral-400 text-xs"></span>
        </a>
        <button
          id="download-dropdown-toggle"
          class="bg-coolgray-300 px-3 py-3 rounded-r border-l border-coolgray-400 hover:bg-coolgray-400 transition-colors cursor-pointer"
          aria-label="Show all platforms"
        >
          <svg class="w-4 h-4 text-neutral-400 transition-transform duration-200" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd"></path>
          </svg>
        </button>
      </div>
      <div id="download-dropdown" class="hidden absolute left-0 right-0 mt-1 bg-coolgray-300 rounded border border-coolgray-400 overflow-hidden z-50">
        <div id="download-dropdown-list" class="divide-y divide-coolgray-400 text-xs md:text-sm font-mono"></div>
      </div>
    </div>
  </section>

  <!-- Screenshots -->
  <section class="mt-4 pb-10 px-4">
    <div class="grid grid-cols-1 gap-4">
      <a href="/screenshots/SCR-20260209-nigu.png" target="_blank" class="block overflow-hidden rounded-xl border border-coolgray-300 hover:border-[#FCD34D]/40 transition-colors">
        <img src="/screenshots/SCR-20260209-nigu.png" alt="Jean project overview with sessions and worktrees" loading="lazy" class="w-full" />
      </a>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <a href="/screenshots/SCR-20260209-ninl.png" target="_blank" class="block overflow-hidden rounded-xl border border-coolgray-300 hover:border-[#FCD34D]/40 transition-colors">
          <img src="/screenshots/SCR-20260209-ninl.png" alt="AI agent resolving merge conflicts" loading="lazy" class="w-full" />
        </a>
        <a href="/screenshots/SCR-20260209-niug.png" target="_blank" class="block overflow-hidden rounded-xl border border-coolgray-300 hover:border-[#FCD34D]/40 transition-colors">
          <img src="/screenshots/SCR-20260209-niug.png" alt="Uncommitted changes diff view" loading="lazy" class="w-full" />
        </a>
        <a href="/screenshots/SCR-20260209-njel.png" target="_blank" class="block overflow-hidden rounded-xl border border-coolgray-300 hover:border-[#FCD34D]/40 transition-colors">
          <img src="/screenshots/SCR-20260209-njel.png" alt="Code editor with AI assistance" loading="lazy" class="w-full" />
        </a>
      </div>
    </div>
  </section>

  <!-- Features Section -->
  <section id="features" class="mt-16 pb-10 px-4">
    <h2 class="text-2xl md:text-4xl font-bold text-center">
      Everything you need<span class="text-[#FCD34D]">.</span>
    </h2>
    <p class="mt-4 text-neutral-400 text-center max-w-2xl mx-auto">
      A complete AI agent workspace, fully open source.
    </p>

    <dl
      class="mt-12 grid grid-cols-1 lg:grid-cols-2 gap-8 max-w-2xl lg:max-w-none"
    >
      <!-- Feature 1 -->
      <div class="flex flex-col">
        <dt class="flex items-center gap-x-3 text-xl text-white">
          <svg
            class="w-6 h-6 text-[#FCD34D] flex-shrink-0"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M3.75 6A2.25 2.25 0 016 3.75h2.25A2.25 2.25 0 0110.5 6v2.25a2.25 2.25 0 01-2.25 2.25H6a2.25 2.25 0 01-2.25-2.25V6zM3.75 15.75A2.25 2.25 0 016 13.5h2.25a2.25 2.25 0 012.25 2.25V18a2.25 2.25 0 01-2.25 2.25H6A2.25 2.25 0 013.75 18v-2.25zM13.5 6a2.25 2.25 0 012.25-2.25H18A2.25 2.25 0 0120.25 6v2.25A2.25 2.25 0 0118 10.5h-2.25a2.25 2.25 0 01-2.25-2.25V6zM13.5 15.75a2.25 2.25 0 012.25-2.25H18a2.25 2.25 0 012.25 2.25V18A2.25 2.25 0 0118 20.25h-2.25A2.25 2.25 0 0113.5 18v-2.25z"
            ></path>
          </svg>
          Isolated Workspaces
        </dt>
        <dd
          class="mt-4 flex flex-auto flex-col text-sm leading-6 text-neutral-400"
        >
          <p class="flex-auto">
            Run multiple AI agents in parallel, each in its own isolated git
            worktree. No conflicts, no interference, maximum throughput.
          </p>
        </dd>
      </div>

      <!-- Feature 2 -->
      <div class="flex flex-col">
        <dt class="flex items-center gap-x-3 text-xl text-white">
          <svg
            class="w-6 h-6 text-[#FCD34D] flex-shrink-0"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.455 2.456L21.75 6l-1.036.259a3.375 3.375 0 00-2.455 2.456zM16.894 20.567L16.5 21.75l-.394-1.183a2.25 2.25 0 00-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 001.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 001.423 1.423l1.183.394-1.183.394a2.25 2.25 0 00-1.423 1.423z"
            ></path>
          </svg>
          Magic Git Commands
        </dt>
        <dd
          class="mt-4 flex flex-auto flex-col text-sm leading-6 text-neutral-400"
        >
          <p class="flex-auto">
            Automated git workflows: review code, create commits, open PRs,
            investigate issues, and resolve merge conflicts with AI assistance.
          </p>
        </dd>
      </div>

      <!-- Feature 3 -->
      <div class="flex flex-col">
        <dt class="flex items-center gap-x-3 text-xl text-white">
          <svg
            class="w-6 h-6 text-[#FCD34D] flex-shrink-0"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"
            ></path>
          </svg>
          Context Loading
        </dt>
        <dd
          class="mt-4 flex flex-auto flex-col text-sm leading-6 text-neutral-400"
        >
          <p class="flex-auto">
            Load context from sessions, GitHub Issues, and Pull Requests
            directly into your AI agent's workspace. No manual copy-pasting.
          </p>
        </dd>
      </div>

      <!-- Feature 4 -->
      <div class="flex flex-col">
        <dt class="flex items-center gap-x-3 text-xl text-white">
          <svg
            class="w-6 h-6 text-[#FCD34D] flex-shrink-0"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M20.25 6.375c0 2.278-3.694 4.125-8.25 4.125S3.75 8.653 3.75 6.375m16.5 0c0-2.278-3.694-4.125-8.25-4.125S3.75 4.097 3.75 6.375m16.5 0v11.25c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125V6.375m16.5 0v3.75m-16.5-3.75v3.75m16.5 0v3.75C20.25 16.153 16.556 18 12 18s-8.25-1.847-8.25-4.125v-3.75m16.5 0c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125"
            ></path>
          </svg>
          Worktree Management
        </dt>
        <dd
          class="mt-4 flex flex-auto flex-col text-sm leading-6 text-neutral-400"
        >
          <p class="flex-auto">
            Automated worktree creation, archiving, and restoration. Manage
            branches and workspaces without touching the command line.
          </p>
        </dd>
      </div>

      <!-- Feature 5 -->
      <div class="flex flex-col">
        <dt class="flex items-center gap-x-3 text-xl text-white">
          <svg
            class="w-6 h-6 text-[#FCD34D] flex-shrink-0"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M7.5 21L3 16.5m0 0L7.5 12M3 16.5h13.5m0-13.5L21 7.5m0 0L16.5 12M21 7.5H7.5"
            ></path>
          </svg>
          Automated Merging
        </dt>
        <dd
          class="mt-4 flex flex-auto flex-col text-sm leading-6 text-neutral-400"
        >
          <p class="flex-auto">
            Merge GitHub PRs or local worktrees automatically. Built-in merge
            conflict resolution powered by AI.
          </p>
        </dd>
      </div>

      <!-- Feature 6 -->
      <div class="flex flex-col">
        <dt class="flex items-center gap-x-3 text-xl text-white">
          <svg
            class="w-6 h-6 text-[#FCD34D] flex-shrink-0"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M10.5 1.5H8.25A2.25 2.25 0 006 3.75v16.5a2.25 2.25 0 002.25 2.25h7.5A2.25 2.25 0 0018 20.25V3.75a2.25 2.25 0 00-2.25-2.25H13.5m-3 0V3h3V1.5m-3 0h3m-3 18.75h3"
            ></path>
          </svg>
          Mobile Access
        </dt>
        <dd
          class="mt-4 flex flex-auto flex-col text-sm leading-6 text-neutral-400"
        >
          <p class="flex-auto">
            Access Jean from your phone via localhost, Cloudflare Tunnel, or
            Tailscale. Monitor and manage your AI agents on the go.
          </p>
        </dd>
      </div>

      <!-- Feature 7 -->
      <div class="flex flex-col">
        <dt class="flex items-center gap-x-3 text-xl text-white">
          <svg
            class="w-6 h-6 text-[#FCD34D] flex-shrink-0"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M14.25 9.75L16.5 12l-2.25 2.25m-4.5 0L7.5 12l2.25-2.25M6 20.25h12A2.25 2.25 0 0020.25 18V6A2.25 2.25 0 0018 3.75H6A2.25 2.25 0 003.75 6v12A2.25 2.25 0 006 20.25z"
            ></path>
          </svg>
          Open Source
        </dt>
        <dd
          class="mt-4 flex flex-auto flex-col text-sm leading-6 text-neutral-400"
        >
          <p class="flex-auto">
            Free forever under the Apache 2.0 license. Inspect the code,
            contribute, and make it your own.
          </p>
        </dd>
      </div>
    </dl>
  </section>

  <!-- FAQ Section -->
  <section id="faq" class="mt-16 pb-10 px-4">
    <h2 class="text-2xl md:text-4xl font-bold text-center">
      Frequently asked questions<span class="text-[#FCD34D]">.</span>
    </h2>
    <p class="mt-4 text-neutral-400 text-center max-w-2xl mx-auto">
      Everything you need to know about Jean.
    </p>

    <div
      class="mt-12 max-w-3xl mx-auto divide-y divide-coolgray-300 border-y border-coolgray-300"
    >
      <!-- FAQ 1 -->
      <div class="faq-item py-4">
        <button
          class="faq-button w-full text-left text-sm font-medium flex justify-between items-center text-white"
          aria-expanded="false"
        >
          <span>What is Jean?</span>
          <svg
            class="w-6 h-6 transition-transform duration-200 flex-shrink-0"
            viewBox="0 0 20 20"
            fill="currentColor"
          >
            <path
              fill-rule="evenodd"
              d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
              clip-rule="evenodd"></path>
          </svg>
        </button>
        <p class="faq-answer hidden mt-2 text-sm text-neutral-300 text-left">
          Jean is an open-source AI assistant desktop application that helps you
          manage multiple projects, worktrees, and sessions with Claude CLI.
          It's designed for developers who work on multiple features or
          repositories simultaneously.
        </p>
      </div>

      <!-- FAQ 2 -->
      <div class="faq-item py-4">
        <button
          class="faq-button w-full text-left text-sm font-medium flex justify-between items-center text-white"
          aria-expanded="false"
        >
          <span>Is Jean really free?</span>
          <svg
            class="w-6 h-6 transition-transform duration-200 flex-shrink-0"
            viewBox="0 0 20 20"
            fill="currentColor"
          >
            <path
              fill-rule="evenodd"
              d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
              clip-rule="evenodd"></path>
          </svg>
        </button>
        <p class="faq-answer hidden mt-2 text-sm text-neutral-300 text-left">
          Yes, 100%. Jean is open source under the Apache 2.0 license. There
          are no paid tiers, no feature gates, and no usage limits. You bring
          your own Claude subscription. If you'd like to support development,
          consider <a href="/sponsorships" class="text-[#FCD34D] underline">sponsoring us</a>.
        </p>
      </div>

      <!-- FAQ 3 -->
      <div class="faq-item py-4">
        <button
          class="faq-button w-full text-left text-sm font-medium flex justify-between items-center text-white"
          aria-expanded="false"
        >
          <span>What platforms does Jean support?</span>
          <svg
            class="w-6 h-6 transition-transform duration-200 flex-shrink-0"
            viewBox="0 0 20 20"
            fill="currentColor"
          >
            <path
              fill-rule="evenodd"
              d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
              clip-rule="evenodd"></path>
          </svg>
        </button>
        <p class="faq-answer hidden mt-2 text-sm text-neutral-300 text-left">
          Jean is currently tested on macOS. Windows and Linux should work but
          are not yet fully tested — we're looking for testers! You'll need
          Node.js and Rust installed as prerequisites.
        </p>
      </div>

      <!-- FAQ 4 -->
      <div class="faq-item py-4">
        <button
          class="faq-button w-full text-left text-sm font-medium flex justify-between items-center text-white"
          aria-expanded="false"
        >
          <span>How does Jean work with git?</span>
          <svg
            class="w-6 h-6 transition-transform duration-200 flex-shrink-0"
            viewBox="0 0 20 20"
            fill="currentColor"
          >
            <path
              fill-rule="evenodd"
              d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
              clip-rule="evenodd"></path>
          </svg>
        </button>
        <p class="faq-answer hidden mt-2 text-sm text-neutral-300 text-left">
          Jean uses git worktrees to create isolated workspaces for each AI
          agent session. It automates common git operations like reviewing code,
          creating commits, opening PRs, and resolving merge conflicts. Each
          workspace is independent, so multiple agents can work on different
          branches simultaneously.
        </p>
      </div>

      <!-- FAQ 5 -->
      <div class="faq-item py-4">
        <button
          class="faq-button w-full text-left text-sm font-medium flex justify-between items-center text-white"
          aria-expanded="false"
        >
          <span>What AI models does Jean use?</span>
          <svg
            class="w-6 h-6 transition-transform duration-200 flex-shrink-0"
            viewBox="0 0 20 20"
            fill="currentColor"
          >
            <path
              fill-rule="evenodd"
              d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
              clip-rule="evenodd"></path>
          </svg>
        </button>
        <p class="faq-answer hidden mt-2 text-sm text-neutral-300 text-left">
          Jean integrates with Anthropic's Claude CLI — you can reuse your
          existing Claude subscription. Support for additional AI coding agents
          like Opencode, Codex, and others is on the roadmap.
        </p>
      </div>

      <!-- FAQ 6 -->
      <div class="faq-item py-4">
        <button
          class="faq-button w-full text-left text-sm font-medium flex justify-between items-center text-white"
          aria-expanded="false"
        >
          <span>How do I contribute?</span>
          <svg
            class="w-6 h-6 transition-transform duration-200 flex-shrink-0"
            viewBox="0 0 20 20"
            fill="currentColor"
          >
            <path
              fill-rule="evenodd"
              d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
              clip-rule="evenodd"></path>
          </svg>
        </button>
        <p class="faq-answer hidden mt-2 text-sm text-neutral-300 text-left">
          We welcome contributions of all kinds &mdash; code, documentation, bug
          reports, and feature requests. Check out the
          <a href="https://github.com/coollabsio/jean" class="text-[#FCD34D] underline" target="_blank">repository's CONTRIBUTING.md</a>
          to get started.
        </p>
      </div>
    </div>
  </section>
</Layout>

<script>
  // FAQ accordion
  document.querySelectorAll(".faq-button").forEach((button) => {
    button.addEventListener("click", () => {
      const answer = button.nextElementSibling as HTMLElement;
      const isOpen = button.getAttribute("aria-expanded") === "true";

      // Close all
      document.querySelectorAll(".faq-button").forEach((btn) => {
        btn.setAttribute("aria-expanded", "false");
        const chevron = btn.querySelector("svg");
        if (chevron) chevron.style.transform = "";
        const ans = btn.nextElementSibling as HTMLElement;
        if (ans) ans.classList.add("hidden");
      });

      // Toggle current
      if (!isOpen) {
        button.setAttribute("aria-expanded", "true");
        const chevron = button.querySelector("svg");
        if (chevron) chevron.style.transform = "rotate(180deg)";
        if (answer) answer.classList.remove("hidden");
      }
    });
  });

  // OS-aware download button
  const btn = document.getElementById("download-btn") as HTMLAnchorElement;
  const label = document.getElementById("download-label");
  const version = document.getElementById("download-version");
  const dropdownToggle = document.getElementById("download-dropdown-toggle");
  const dropdown = document.getElementById("download-dropdown");
  const dropdownList = document.getElementById("download-dropdown-list");

  const ua = navigator.userAgent.toLowerCase();
  let os = "unknown";
  if (ua.includes("mac")) os = "mac";
  else if (ua.includes("win")) os = "windows";
  else if (ua.includes("linux")) os = "linux";

  const osLabels: Record<string, string> = {
    mac: "Download for macOS",
    windows: "Download for Windows",
    linux: "Download for Linux",
    unknown: "Download Latest Release",
  };

  if (label) label.textContent = osLabels[os];

  // Friendly names for assets
  const assetLabels: Record<string, string> = {
    ".dmg": "macOS (DMG)",
    ".app.tar.gz": "macOS (tar.gz)",
    "-setup.exe": "Windows (EXE)",
    ".msi": "Windows (MSI)",
    ".AppImage": "Linux (AppImage)",
    ".deb": "Linux (DEB)",
    ".rpm": "Linux (RPM)",
  };

  const assetOrder = [".dmg", ".app.tar.gz", "-setup.exe", ".msi", ".AppImage", ".deb", ".rpm"];

  // Toggle dropdown
  if (dropdownToggle && dropdown) {
    dropdownToggle.addEventListener("click", () => {
      const isOpen = !dropdown.classList.contains("hidden");
      dropdown.classList.toggle("hidden");
      const chevron = dropdownToggle.querySelector("svg");
      if (chevron) chevron.style.transform = isOpen ? "" : "rotate(180deg)";
    });

    // Close on outside click
    document.addEventListener("click", (e) => {
      if (!(e.target as Element).closest("#download-dropdown-toggle") && !(e.target as Element).closest("#download-dropdown")) {
        dropdown.classList.add("hidden");
        const chevron = dropdownToggle.querySelector("svg");
        if (chevron) chevron.style.transform = "";
      }
    });
  }

  // Cache release data in localStorage (1 hour TTL)
  const CACHE_KEY = "jean-release";
  const CACHE_TTL = 60 * 60 * 1000; // 1 hour

  function applyReleaseData(data: { tag_name?: string; assets?: { name: string; browser_download_url: string }[] }) {
    if (version && data.tag_name) {
      version.textContent = data.tag_name;
    }
    const assets = data.assets || [];

    let asset: { name: string; browser_download_url: string } | undefined;
    if (os === "mac") {
      asset = assets.find((a) => a.name.endsWith(".dmg"));
    } else if (os === "windows") {
      asset = assets.find((a) => a.name.endsWith("-setup.exe"));
    } else if (os === "linux") {
      asset = assets.find((a) => a.name.endsWith(".AppImage"));
    }

    if (asset && btn) {
      btn.href = asset.browser_download_url;
    }

    if (dropdownList) {
      dropdownList.innerHTML = "";
      const sorted = assetOrder
        .map((ext) => assets.find((a) => a.name.endsWith(ext)))
        .filter(Boolean) as { name: string; browser_download_url: string }[];

      sorted.forEach((a) => {
        const ext = assetOrder.find((e) => a.name.endsWith(e)) || a.name;
        const link = document.createElement("a");
        link.href = a.browser_download_url;
        link.className = "flex items-center justify-between px-4 py-2.5 hover:bg-coolgray-400 transition-colors text-white";
        link.innerHTML = `<span>${assetLabels[ext] || a.name}</span><span class="text-neutral-400 text-xs">${a.name}</span>`;
        dropdownList.appendChild(link);
      });
    }
  }

  let cached: { ts: number; data: any } | null = null;
  try {
    const raw = localStorage.getItem(CACHE_KEY);
    if (raw) cached = JSON.parse(raw);
  } catch {}

  if (cached && Date.now() - cached.ts < CACHE_TTL) {
    applyReleaseData(cached.data);
  } else {
    fetch("https://api.github.com/repos/coollabsio/jean/releases/latest")
      .then((res) => res.json())
      .then((data) => {
        try {
          localStorage.setItem(CACHE_KEY, JSON.stringify({ ts: Date.now(), data }));
        } catch {}
        applyReleaseData(data);
      })
      .catch(() => {
        if (cached) {
          applyReleaseData(cached.data);
        } else if (btn) {
          btn.href = "https://github.com/coollabsio/jean/releases/latest";
        }
      });
  }
</script>
